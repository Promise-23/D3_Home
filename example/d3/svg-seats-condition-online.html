<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>坐席情况在线数</title>
  <style>
    #test {
      width: 80%;
      height: 400px;
      margin: 0 auto;
      background: #4e4c4c;
    }

    .cls-1,
    .cls-2 {
      fill: #6cf;
    }

    .cls-1 {
      fill-opacity: 0.05;
    }

    .cls-2,
    .cls-3,
    .cls-4,
    .cls-5,
    .cls-6 {
      fill-rule: evenodd;
    }

    .cls-2 {
      filter: url(#filter);
    }

    .cls-3 {
      fill: #fa6463;
    }

    .cls-4 {
      fill: #ff9549;
    }

    .cls-5 {
      fill: #fde466;
    }

    .cls-6 {
      fill: #62c7fb;
    }

    .cls-7 {
      font-size: 20px;
      opacity: 0.8;
      font-family: "Microsoft YaHei";
      font-weight: 700;
    }

    .cls-7,
    .cls-8 {
      fill: #fff;
    }

    .cls-8 {
      font-size: 36px;
      filter: url(#filter-2);
      font-family: Impact;
    }
  </style>
</head>

<body>
  <div id="test">
    <svg id="组_11_拷贝" data-name="组 11 拷贝" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
      width="389" height="95" viewBox="0 0 389 95">
      <defs>
        <clipPath id="clipPath">
          <path id="layer" />
        </clipPath>
        <filter id="filter" x="71" y="228" width="389" height="95" filterUnits="userSpaceOnUse">
          <feGaussianBlur result="blur" stdDeviation="3.333" in="SourceAlpha" />
          <feComposite result="composite" />
          <feComposite result="composite-2" />
          <feComposite result="composite-3" />
          <feFlood result="flood" flood-color="#6cf" flood-opacity="0.4" />
          <feComposite result="composite-4" operator="in" in2="composite-3" />
          <feBlend result="blend" in2="SourceGraphic" />
          <feBlend result="blend-2" in="SourceGraphic" />
        </filter>
        <filter id="filter-2" x="295" y="17" width="75" height="49" filterUnits="userSpaceOnUse">
          <feGaussianBlur result="blur" stdDeviation="3.333" in="SourceAlpha" />
          <feComposite result="composite" />
          <feComposite result="composite-2" />
          <feComposite result="composite-3" />
          <feFlood result="flood" flood-color="#fec" flood-opacity="0.2" />
          <feComposite result="composite-4" operator="in" in2="composite-3" />
          <feBlend result="blend" in2="SourceGraphic" />
          <feBlend result="blend-2" in="SourceGraphic" />
        </filter>
      </defs>
      <rect id="矩形_6" data-name="矩形 6" class="cls-1" x="9" y="9" width="370" height="76" />
      <path id="矩形_681_拷贝_3" data-name="矩形 681 拷贝 3" class="cls-2"
        d="M80,237h6v2H80v-2Zm0,0h2v6H80v-6Zm368,0h2v6h-2v-6Zm-4,0h6v2h-6v-2ZM80,311h6v2H80v-2Zm0-4h2v6H80v-6Zm368,0h2v6h-2v-6Zm-4,4h6v2h-6v-2Z"
        transform="translate(-71 -228)" />
      <g id="组_795" data-name="组 795" clip-path="url(#clipPath)">
        <path id="矩形_519_拷贝_8" data-name="矩形 519 拷贝 8" class="cls-3"
          d="M424,299l4-8h3l-4,8h-3Zm-1-8h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8H99Z"
          transform="translate(-71 -228)" />
        <path id="矩形_519_拷贝_9" data-name="矩形 519 拷贝 9" class="cls-4"
          d="M408,291h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Zm-5,0h3l-4,8h-3Z"
          transform="translate(-71 -228)" />
        <path id="矩形_519_拷贝_10" data-name="矩形 519 拷贝 10" class="cls-5" d="M418,291h3l-4,8h-3Zm-5,0h3l-4,8h-3Z"
          transform="translate(-71 -228)" />
        <path id="矩形_519_拷贝_11" data-name="矩形 519 拷贝 11" class="cls-6" d="M424,299l4-8h3l-4,8h-3Zm-1-8h3l-4,8h-3Z"
          transform="translate(-71 -228)" />
      </g>
      <text id="在线数" class="cls-7" x="29" y="48">在线数</text>
      <text id="_568" data-name="568" class="cls-8 text-value" x="303" y="54.999">568</text>
    </svg>
    <div id="myForm">
      <input type="text" id="max_num" placeholder="容器最大数" />
      <input type="text" id="text" placeholder="请输入0-100的数" />
      <button id="change">变</button>
    </div>
  </div>
  <script src="../../js/d3.js"></script>
  <script>
    /*
  *  @param id  id值，如本例使用的#test
  *  @param value 变化的最终值
  */
    function draw(paramsObj) {
      var id = paramsObj.id;
      var progress = paramsObj.value;
      var max_num = paramsObj.max_num;
      var svg = d3.select(id).select("svg");
      var text = svg.select('.text-value');
      //线性比例尺
      var linear = d3.scaleLinear()
        .domain([0, max_num])
        .range([0, 336]);
      //区域生成器
      var areaPath = d3.area()
        .y(function (d, i) { return i * 10 })
        .x0(function (d, i) { return 0 })
        .x1(function (d, i) { return 0 + d });

      var clipPath = d3.select(id).select('#layer');
      clipPath.attr('transform', 'translate(' + 20 + ',' + 50 + ')')
        .transition()
        .duration(1000)
        //.attr("d",area)
        .attrTween('d', tween);
      function tween() {
        var i = d3.interpolate(0, 0 + linear(progress));
        return function (t) {
          text.html(Math.round(t * progress));
          return areaPath([i(t), i(t) + 4, i(t), i(t) + 4]);
        };
      }
    }

    var btn = document.getElementById('change');
    draw({ id: "#test", value: 600 ,max_num:600});
    btn.addEventListener("click", function () {
      var input = document.getElementById('text').value;
      var max_num = document.getElementById('max_num').value;
      btn.value = input;
      draw({ id: "#test", value: input ,max_num:max_num});
    }, false);
    // range.addEventListener("change", function () {
    //   var input1 = document.getElementById('text');
    //   input1.value = range.value;
    //   draw({ id: "#test", value: range.value });
    // })
  </script>
</body>