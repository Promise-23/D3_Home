<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>半截仪表盘</title>
    <style>
        #myForm {
            position: absolute;
            left: 20%;
            top: 60%;
        }

        #myForm div {
            margin: 20px 0;
        }

        #test {
            width: 80%;
            height: 500px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
<div id="test">
    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="xMidYMid"
         width="100%" height="100%" viewBox="-20 -20 400 400">
        <defs>
            <style>
                .cls-1 {
                    fill: #d3dae6;
                }

                .cls-1, .cls-2, .cls-4 {
                    fill-rule: evenodd;
                }

                .cls-2, .cls-3 {
                    fill: #6898d5;
                }

                .cls-4, .cls-6 {
                    fill: #fff;
                }

                .cls-4 {
                    opacity: 0.2;
                }

                .cls-5, .cls-6 {
                    font-size: 54.2558px;
                }

                .cls-6 {
                    text-anchor: middle;
                    font-family: "Arial";
                }

                .pei {
                    stroke: #36394d;
                    stroke-width: 10px;
                    fill: #36394d;
                    stroke-linejoin: round;
                }

                .pei-small {
                    stroke: #688cba;
                    stroke-width: 6px;
                    fill: #36394d;
                    stroke-linejoin: round;
                }

                .lighting-dots {
                    fill: #6898d5;
                    filter: url(#outer-glow-1);
                }

                #center-text {
                    fill: #fff;
                    font-size: 40px;
                    text-anchor: middle; /* 文本水平居中 */
                    dominant-baseline: auto; /* 文本垂直居中 */
                }
            </style>

            <filter id="outer-glow-1" filterUnits="userSpaceOnUse">
                <feGaussianBlur stdDeviation="6.667" in="SourceAlpha"/>
                <feComposite/>
                <feComposite/>
                <feComposite result="outerGlowBlur"/>
                <feFlood flood-color="#5d9cec" flood-opacity="0.35"/>
                <feComposite operator="in" in2="outerGlowBlur"/>
                <feBlend mode="screen" in2="SourceGraphic" result="outerGlow"/>
                <feComposite in="SourceGraphic" result="shadowed"/>
            </filter>

            <clipPath id="clipPath">
                <path id="layer"/>
            </clipPath>
        </defs>
        <g>
            <path d="M331.635,213.046 C335.114,199.626 336.968,185.550 336.968,171.039 C336.968,79.018 262.524,4.421 170.691,4.421 C78.859,4.421 4.414,79.018 4.414,171.039 C4.414,185.136 6.169,198.821 9.458,211.895 L5.176,212.975 C1.800,199.555 -0.000,185.509 -0.000,171.039 C-0.000,76.575 76.421,-0.003 170.691,-0.003 C264.962,-0.003 341.383,76.575 341.383,171.039 C341.383,185.950 339.474,200.414 335.896,214.204 L331.635,213.046 Z"
                  class="cls-2"/>
            <path d="M265.221,147.947 L320.516,133.101 C323.396,144.555 324.997,156.518 325.169,168.827 L267.945,168.827 C267.787,161.647 266.858,154.661 265.221,147.947 ZM255.993,124.243 L305.601,95.543 C311.417,105.956 316.075,117.106 319.382,128.826 L264.071,143.677 C262.072,136.858 259.359,130.348 255.993,124.243 ZM240.914,103.800 L281.485,63.146 C289.841,71.759 297.205,81.342 303.392,91.713 L253.775,120.418 C250.097,114.412 245.770,108.851 240.914,103.800 ZM221.119,87.940 L249.855,38.066 C260.204,44.266 269.767,51.645 278.364,60.018 L237.780,100.685 C232.710,95.869 227.136,91.579 221.119,87.940 ZM197.906,77.810 L212.818,22.043 C224.514,25.357 235.641,30.025 246.033,35.852 L217.290,85.739 C211.197,82.424 204.700,79.769 197.906,77.810 ZM172.899,74.048 L172.899,16.245 C185.183,16.417 197.121,18.021 208.552,20.907 L193.637,76.683 C186.965,75.088 180.027,74.185 172.899,74.048 ZM147.782,76.818 L132.831,20.907 C144.262,18.021 156.200,16.417 168.484,16.245 L168.484,74.064 C161.366,74.245 154.439,75.182 147.782,76.818 ZM124.246,86.005 L95.350,35.852 C105.741,30.025 116.869,25.357 128.565,22.043 L143.520,77.973 C136.760,79.967 130.304,82.666 124.246,86.005 ZM103.904,100.987 L63.019,60.018 C71.615,51.645 81.178,44.266 91.528,38.066 L120.425,88.220 C114.457,91.875 108.929,96.170 103.904,100.987 ZM88.058,120.679 L37.990,91.713 C44.178,81.342 51.541,71.759 59.897,63.146 L100.784,104.116 C95.981,109.158 91.695,114.696 88.058,120.679 ZM77.885,143.831 L22.001,128.826 C25.308,117.106 29.966,105.956 35.782,95.543 L85.853,124.511 C82.530,130.583 79.858,137.057 77.885,143.831 ZM74.055,168.827 L16.214,168.827 C16.386,156.518 17.987,144.555 20.866,133.101 L76.743,148.104 C75.130,154.769 74.212,161.703 74.055,168.827 ZM76.760,193.969 L20.866,208.977 C17.987,197.522 16.386,185.560 16.214,173.250 L74.057,173.250 C74.220,180.373 75.141,187.305 76.760,193.969 ZM267.943,173.250 L325.169,173.250 C324.997,185.560 323.396,197.522 320.516,208.977 L265.204,194.125 C266.846,187.414 267.779,180.429 267.943,173.250 Z"
                  class="cls-2"/>
        </g>
        <g clip-path="url(#clipPath)">
            <path d="M331.635,213.046 C335.114,199.626 336.968,185.550 336.968,171.039 C336.968,79.018 262.524,4.421 170.691,4.421 C78.859,4.421 4.414,79.018 4.414,171.039 C4.414,185.136 6.169,198.821 9.458,211.895 L5.176,212.975 C1.800,199.555 -0.000,185.509 -0.000,171.039 C-0.000,76.575 76.421,-0.003 170.691,-0.003 C264.962,-0.003 341.383,76.575 341.383,171.039 C341.383,185.950 339.474,200.414 335.896,214.204 L331.635,213.046 Z"
                  class="cls-1"/>
            <path d="M265.221,147.947 L320.516,133.101 C323.396,144.555 324.997,156.518 325.169,168.827 L267.945,168.827 C267.787,161.647 266.858,154.661 265.221,147.947 ZM255.993,124.243 L305.601,95.543 C311.417,105.956 316.075,117.106 319.382,128.826 L264.071,143.677 C262.072,136.858 259.359,130.348 255.993,124.243 ZM240.914,103.800 L281.485,63.146 C289.841,71.759 297.205,81.342 303.392,91.713 L253.775,120.418 C250.097,114.412 245.770,108.851 240.914,103.800 ZM221.119,87.940 L249.855,38.066 C260.204,44.266 269.767,51.645 278.364,60.018 L237.780,100.685 C232.710,95.869 227.136,91.579 221.119,87.940 ZM197.906,77.810 L212.818,22.043 C224.514,25.357 235.641,30.025 246.033,35.852 L217.290,85.739 C211.197,82.424 204.700,79.769 197.906,77.810 ZM172.899,74.048 L172.899,16.245 C185.183,16.417 197.121,18.021 208.552,20.907 L193.637,76.683 C186.965,75.088 180.027,74.185 172.899,74.048 ZM147.782,76.818 L132.831,20.907 C144.262,18.021 156.200,16.417 168.484,16.245 L168.484,74.064 C161.366,74.245 154.439,75.182 147.782,76.818 ZM124.246,86.005 L95.350,35.852 C105.741,30.025 116.869,25.357 128.565,22.043 L143.520,77.973 C136.760,79.967 130.304,82.666 124.246,86.005 ZM103.904,100.987 L63.019,60.018 C71.615,51.645 81.178,44.266 91.528,38.066 L120.425,88.220 C114.457,91.875 108.929,96.170 103.904,100.987 ZM88.058,120.679 L37.990,91.713 C44.178,81.342 51.541,71.759 59.897,63.146 L100.784,104.116 C95.981,109.158 91.695,114.696 88.058,120.679 ZM77.885,143.831 L22.001,128.826 C25.308,117.106 29.966,105.956 35.782,95.543 L85.853,124.511 C82.530,130.583 79.858,137.057 77.885,143.831 ZM74.055,168.827 L16.214,168.827 C16.386,156.518 17.987,144.555 20.866,133.101 L76.743,148.104 C75.130,154.769 74.212,161.703 74.055,168.827 ZM76.760,193.969 L20.866,208.977 C17.987,197.522 16.386,185.560 16.214,173.250 L74.057,173.250 C74.220,180.373 75.141,187.305 76.760,193.969 ZM267.943,173.250 L325.169,173.250 C324.997,185.560 323.396,197.522 320.516,208.977 L265.204,194.125 C266.846,187.414 267.779,180.429 267.943,173.250 Z"
                  class="cls-1"/>
        </g>
        <g>
            <path d="M303.097,173.250 L325.169,173.250 C325.062,180.916 324.399,188.446 323.220,195.804 C323.208,195.881 323.194,195.958 323.182,196.036 C322.964,197.381 322.728,198.721 322.476,200.054 C322.445,200.219 322.413,200.383 322.382,200.548 C322.135,201.830 321.872,203.107 321.594,204.378 C321.561,204.528 321.529,204.679 321.496,204.829 C321.187,206.218 320.862,207.601 320.516,208.977 L299.188,203.250 C301.583,193.623 302.928,183.581 303.097,173.250 ZM38.286,173.250 C38.455,183.581 39.799,193.623 42.195,203.250 L20.866,208.977 C20.521,207.601 20.196,206.218 19.887,204.829 C19.854,204.679 19.822,204.528 19.789,204.378 C19.511,203.107 19.248,201.830 19.001,200.548 C18.969,200.383 18.938,200.219 18.907,200.054 C18.654,198.721 18.419,197.381 18.201,196.036 C18.188,195.958 18.175,195.881 18.162,195.804 C16.983,188.446 16.321,180.916 16.214,173.250 L38.286,173.250 ZM42.195,138.828 C39.799,148.455 38.455,158.497 38.286,168.827 L16.214,168.827 C16.321,161.161 16.983,153.631 18.162,146.274 C18.175,146.196 18.188,146.119 18.201,146.042 C18.419,144.696 18.654,143.357 18.907,142.023 C18.938,141.859 18.969,141.694 19.001,141.530 C19.248,140.247 19.511,138.970 19.789,137.699 C19.822,137.549 19.854,137.399 19.887,137.249 C20.196,135.859 20.521,134.476 20.866,133.101 L42.195,138.828 ZM54.900,106.604 C50.037,115.360 46.128,124.721 43.329,134.552 L22.001,128.826 C22.400,127.409 22.822,126.001 23.261,124.600 C23.331,124.378 23.406,124.158 23.477,123.935 C23.843,122.788 24.219,121.646 24.611,120.510 C24.720,120.191 24.834,119.873 24.946,119.554 C25.324,118.482 25.712,117.414 26.112,116.352 C26.218,116.071 26.325,115.789 26.433,115.509 C26.891,114.315 27.362,113.129 27.849,111.950 C27.898,111.831 27.945,111.710 27.995,111.591 C30.289,106.073 32.892,100.717 35.782,95.543 L54.900,106.604 ZM75.505,78.785 C68.506,86.034 62.324,94.079 57.108,102.773 L37.990,91.713 L37.990,91.713 C40.309,87.828 42.792,84.053 45.430,80.399 C45.437,80.389 45.445,80.379 45.452,80.369 C46.313,79.177 47.191,77.998 48.086,76.831 C48.114,76.795 48.142,76.758 48.170,76.721 C51.818,71.970 55.734,67.437 59.897,63.146 L59.897,63.146 L75.505,78.785 ZM102.566,57.223 C93.889,62.449 85.861,68.644 78.626,75.657 L63.019,60.018 C63.019,60.018 63.019,60.018 63.019,60.018 C67.302,55.846 71.825,51.922 76.566,48.266 C76.603,48.238 76.640,48.210 76.676,48.182 C77.841,47.286 79.017,46.406 80.207,45.543 C80.217,45.535 80.227,45.528 80.237,45.521 C83.884,42.877 87.651,40.389 91.528,38.066 L91.528,38.066 L102.566,57.223 ZM134.279,43.415 C124.468,46.220 115.126,50.137 106.388,55.011 L95.350,35.852 C100.513,32.957 105.859,30.349 111.365,28.050 C111.484,28.000 111.604,27.953 111.724,27.903 C112.900,27.416 114.084,26.944 115.275,26.485 C115.555,26.377 115.836,26.270 116.117,26.164 C117.176,25.762 118.242,25.374 119.312,24.995 C119.630,24.883 119.947,24.769 120.266,24.659 C121.399,24.266 122.539,23.889 123.684,23.523 C123.906,23.452 124.126,23.377 124.348,23.307 C125.745,22.867 127.151,22.444 128.565,22.043 L134.279,43.415 ZM138.546,42.279 L132.831,20.907 C134.203,20.560 135.584,20.235 136.971,19.926 C137.120,19.892 137.270,19.860 137.420,19.827 C138.689,19.549 139.963,19.285 141.243,19.038 C141.407,19.006 141.571,18.975 141.735,18.943 C143.066,18.690 144.403,18.454 145.745,18.236 C145.823,18.223 145.900,18.210 145.977,18.197 C153.319,17.016 160.834,16.352 168.484,16.245 L168.484,38.362 C158.175,38.531 148.153,39.879 138.546,42.279 ZM202.837,42.279 C193.230,39.879 183.207,38.531 172.899,38.362 L172.899,16.245 C180.548,16.352 188.063,17.016 195.406,18.197 C195.483,18.210 195.560,18.223 195.637,18.236 C196.980,18.454 198.317,18.690 199.648,18.943 C199.812,18.975 199.976,19.006 200.140,19.038 C201.420,19.285 202.694,19.549 203.963,19.827 C204.112,19.860 204.262,19.892 204.412,19.926 C205.799,20.235 207.179,20.560 208.552,20.907 L202.837,42.279 ZM234.995,55.011 C226.256,50.137 216.915,46.220 207.103,43.415 L212.818,22.043 C214.232,22.444 215.637,22.867 217.035,23.307 C217.257,23.377 217.477,23.452 217.698,23.523 C218.843,23.889 219.983,24.266 221.117,24.659 C221.435,24.769 221.752,24.883 222.070,24.995 C223.141,25.374 224.207,25.762 225.266,26.164 C225.547,26.270 225.828,26.377 226.108,26.485 C227.299,26.944 228.483,27.416 229.659,27.903 C229.778,27.953 229.899,28.000 230.018,28.050 C235.524,30.349 240.869,32.957 246.033,35.852 L234.995,55.011 ZM262.757,75.657 C255.522,68.644 247.494,62.449 238.817,57.223 L249.855,38.066 L249.855,38.066 C253.732,40.389 257.499,42.877 261.146,45.521 C261.156,45.528 261.165,45.535 261.175,45.543 C262.365,46.406 263.542,47.286 264.706,48.182 C264.743,48.210 264.780,48.238 264.816,48.266 C269.557,51.922 274.081,55.846 278.364,60.018 C278.364,60.018 278.364,60.018 278.364,60.018 L262.757,75.657 ZM284.274,102.773 C279.059,94.079 272.877,86.034 265.878,78.785 L281.485,63.146 L281.485,63.146 C285.648,67.437 289.565,71.970 293.213,76.721 C293.241,76.758 293.269,76.795 293.297,76.831 C294.191,77.998 295.070,79.177 295.931,80.369 C295.938,80.379 295.945,80.389 295.953,80.399 C298.591,84.053 301.074,87.828 303.392,91.713 L303.392,91.713 L284.274,102.773 ZM298.054,134.552 C295.254,124.721 291.345,115.360 286.482,106.604 L305.601,95.543 C308.491,100.717 311.093,106.073 313.388,111.591 C313.437,111.710 313.485,111.831 313.534,111.950 C314.021,113.129 314.492,114.315 314.950,115.509 C315.058,115.789 315.164,116.071 315.270,116.352 C315.671,117.414 316.058,118.482 316.436,119.554 C316.548,119.873 316.662,120.191 316.772,120.510 C317.164,121.646 317.540,122.788 317.906,123.935 C317.977,124.158 318.052,124.378 318.121,124.600 C318.560,126.001 318.982,127.409 319.382,128.826 L298.054,134.552 ZM303.097,168.827 C302.928,158.497 301.583,148.455 299.188,138.828 L320.516,133.101 C320.862,134.476 321.187,135.859 321.496,137.249 C321.529,137.399 321.561,137.549 321.594,137.699 C321.872,138.970 322.135,140.247 322.382,141.530 C322.413,141.694 322.445,141.859 322.476,142.023 C322.728,143.357 322.964,144.696 323.182,146.042 C323.194,146.119 323.208,146.196 323.220,146.274 C324.399,153.631 325.062,161.161 325.169,168.827 L303.097,168.827 Z"
                  class="cls-4"/>
            <circle cx="171" cy="170" r="80" class="pei"/>
            <circle cx="171" cy="170" r="80" class="pei-small"/>
            <text id="center-text" x="173" y="180"></text>
            <circle class="lighting-dots cls-3"/>
        </g>
    </svg>
</div>

<div id="myForm">
    <input type="text" id="text" placeholder="请输入0-100的数"/>
    <div>
        <input type="range" name="points" min="0" max="100%" value="80%" id="range"/>
    </div>
    <button id="change">变</button>
</div>
<script src="../../js/d3.js"></script>
<script>
    /*
   *  @param id  id值，如本例使用的#test
   *  @param value 变化的最终值
   */
    function draw(paramsObj) {
        var id = paramsObj.id;
        var progress = paramsObj.value;

        var svg = d3.select(id).select('svg');

        var currentValue = svg.attr("data-value") || 0;
        svg.attr('data-value', progress);
        var oldValue = currentValue;

        var path = svg.select('#layer');
        var lightingDots = svg.select('.lighting-dots');
        var text = svg.select('#center-text');
        var currentPoint = (valueToDegrees(oldValue || 0));
        var oldValue2 = oldValue;

        var arcs = d3.arc()
            .outerRadius(180)
            .innerRadius(0);
        path.attr('transform', 'translate(' + 170 + ',' + 170 + ')')
            .transition()
            .duration(1000)
            .attrTween('d', tween);

        function tween() {
            var b = {};
            b.startAngle = valueToRadians(progress);
            b.endAngle = valueToRadians(100);
            var i = d3.interpolate(
                {startAngle: valueToRadians(oldValue || 0), endAngle: valueToRadians(100)},
                b
            );
            return function (t) {
                return arcs(i(t));
            };
        }

        //绘制动画小球
        lightingDots.attr('cx', '7.72')
            .attr('cy', "214")
            .attr('r', 5)
            .transition()
            .duration(1000)
            .attrTween("transform", function () {
                var targetRotation = (valueToDegrees(progress));
                //现在的角度
                var currentRotation = currentPoint || targetRotation;
                if (currentPoint == 0) {
                    currentRotation = 0;
                }
                return function (step) {
                    var rotation = currentRotation + (targetRotation - currentRotation) * (step);
                    var textValue = (oldValue2 || 0) - ((oldValue2 || 0) - progress) * step;
                    textValue = Math.round(textValue * 100) / 100 + "%";  //处理文本小数
                    text         //添加文本
                        .text(textValue); //文字内容
                    return " rotate(" + rotation + ", " + 170 + ", " + 170 + ")";   //定义旋转
                }
            })

        function valueToDegrees(value) {
            return value / 100 * 210
        }

        function valueToCurrentDegrees(value) {
            return value / 100 * 210 - 105
        }

        function valueToRadians(value) {
            return valueToCurrentDegrees(value) * Math.PI / 180;
        }
    }
</script>
<script>
    draw({id: "#test", value: 92.15});
    var btn = document.getElementById('change');
    btn.addEventListener("click", function () {
        var input = document.getElementById('text').value;
        range.value = input;
        draw({id: "#test", value: input});
    }, false);
    range.addEventListener("change", function () {
        var input1 = document.getElementById('text');
        input1.value = range.value;
        draw({id: "#test", value: range.value});
    });
</script>

</body>
</html>